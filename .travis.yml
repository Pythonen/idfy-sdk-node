language: csharp
mono: none
dotnet: 2.1

env:
  global:
    - IDFY_MOCK_SERVER_VERSION=0.0.3
    - NODE_VERSION=8

before_install:
  # Download, unpack and run the Idfy Mock Server
  - |
    mkdir -p idfy-mock-server/idfy-mock-server_${IDFY_MOCK_SERVER_VERSION}/
    curl -L "https://github.com/idfy-io/idfy-mock-server/releases/download/v${IDFY_MOCK_SERVER_VERSION}/idfy-mock-server_${IDFY_MOCK_SERVER_VERSION}.zip" -o "idfy-mock-server/idfy-mock-server_${IDFY_MOCK_SERVER_VERSION}.zip"
    unzip "idfy-mock-server/idfy-mock-server_${IDFY_MOCK_SERVER_VERSION}.zip" -d "idfy-mock-server/idfy-mock-server_${IDFY_MOCK_SERVER_VERSION}/"
    dotnet "idfy-mock-server/idfy-mock-server_${IDFY_MOCK_SERVER_VERSION}/Idfy.MockServer.dll" &

install:
  - nvm install ${NODE_VERSION}
  - nvm use ${NODE_VERSION}
  - yarn install

script:
  - yarn test

deploy:
  # Create GitHub release on new version:
  - provider: releases
    api_key: $GITHUB_OAUTH_TOKEN
    name: $TRAVIS_TAG
    on:
      tags: true
  # Push package to npmjs.com
  - provider: npm
    skip_cleanup: true
    email: support@idfy.io
    api_key: $NPM_TOKEN
    on:
      tags: true
